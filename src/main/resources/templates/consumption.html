<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head>
    <meta charset="UTF-8">
    <title>消费查询</title>
    <link rel="stylesheet" type="text/css" href="../static/easyui/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="../static/easyui/themes/icon.css">

    <script type="text/javascript" src="../static/easyui/jquery.min.js"></script>
    <script type="text/javascript" src="../static/easyui/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="../static/js/include.js"></script>
    <script type="text/javascript" src="../static/easyui/locale/easyui-lang-zh_CN.js"></script>
</head>
<body>

<form id="ff" name="ff" method="post">
    <div style="margin-bottom:10px">
        <input type="hidden" name="id" id="id"
               style="width: 160px" data-options="label:'卡号',required:false">
        <input class="easyui-textbox" name="name" id="name"
               style=" width: 200px"  data-options="label:'姓名',required:false">
        <!--<input class="easyui-numberbox" name="money" id="money"
                style=" width: 200px"  data-options="label:'手机号',required:true,precision:0,min:0">
         <select  class="easyui-combobox" name="status" id="status" panelMaxHeight="64px"
                  style=" width: 200px"  data-options="label:'状态',required:true, textField:'text',valueField:'id',editable:false ">
             <option>正常</option>
             <option>挂失</option>
         </select>-->
    </div>
</form>

<div id="tb">
    <a href="#" class="easyui-linkbutton"
       iconCls="icon-search" plian="true" onclick="queryStudent()">查询</a>
    <a href="#" class="easyui-linkbutton"
       iconCls="icon-remove" plian="true" onclick="deleteConsumption()">删除</a>

</div>

<table class="easyui-datagrid" id="dg" name="dg" style="height: auto">
    <thead>
    <th field="ck" checkbox="true" ></th>
    <th field="userId" width="25%" align="center">卡号</th>
    <th field="name" width="25%" align="center">姓名</th>
    <th field="money" width="25%" align="center">消费额</th>
    <th field="time" width="25%" align="center">时间</th>
    </thead>
</table>


</body>
<script type="text/javascript">
    var grid;
    $(document).ready(function () {
        grid=$('#dg').datagrid({
            url:'http://localhost:8080/vip/conByUser',
            rownumbers:true,
            striped:true,
//            fit:true,
            toolbar:'#tb',
//          singleSelect:true //单选模式
            pagination:true,
            pageSize:2,
            pageList:[1,2,3,4]
        });
    });

    function queryStudent(){
        let row =$('#ff').serializeArray();
        $('#dg').datagrid('load',{
            name:$('#name').val()
        });
    }

    function deleteConsumption() {
        let ids = getIds(grid, "id");
        alert(ids);
        $.ajax({
            url: 'http://localhost:8080/vip/deleteConsumption',
            data: {
                ids: ids
            },
            success: function (data) {
                alert(data.msg);
                grid.datagrid('reload');

            },
            error: function (data) {
                alert('删除消费记录失败');
            }
        })
    }
</script>

</html>